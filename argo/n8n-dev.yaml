# ============================================================================
# Argo CD Application - Development Environment
# ============================================================================
# This file defines an Argo CD Application resource that manages the
# deployment of n8n to the development environment. Argo CD monitors the
# Git repository and automatically syncs changes when detected.
# ============================================================================

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  # Application name - used to identify this application in Argo CD
  name: n8n-dev
  # Namespace where Argo CD is installed (typically 'argocd')
  namespace: argocd
spec:
  # Argo CD project - groups applications for access control
  # 'default' project allows all applications
  project: default

  # Source configuration - defines where to get the application manifests
  source:
    # Git repository URL containing the Helm chart
    repoURL: https://github.com/Nomad-1111/n8n.git
    # Git branch or tag to monitor for changes
    # 'develop' branch triggers deployments to dev environment
    targetRevision: develop
    # Path within repository containing Helm chart
    path: helm
    # Helm-specific configuration
    helm:
      # Values files to use when rendering the Helm chart
      # These files override default chart values
      valueFiles:
        - values-dev.yaml

  # Destination configuration - defines where to deploy the application
  destination:
    # Kubernetes cluster API server URL
    # 'https://kubernetes.default.svc' refers to the cluster where Argo CD runs
    server: https://kubernetes.default.svc
    # Target namespace for deployment
    # Argo CD will create this namespace if it doesn't exist (see syncOptions)
    namespace: n8n-dev

  # Sync policy - defines how Argo CD manages application synchronization
  syncPolicy:
    # Automated sync configuration
    automated:
      # Prune: Automatically delete resources that are no longer in Git
      # If a resource exists in cluster but not in Git, Argo CD will delete it
      prune: true
      # Self-heal: Automatically correct drift from Git state
      # If someone manually changes resources in cluster, Argo CD will revert them
      selfHeal: true
    # Sync options - additional synchronization behaviors
    syncOptions:
      # CreateNamespace: Automatically create the target namespace if missing
      # Without this, namespace must exist before Argo CD can deploy
      - CreateNamespace=true

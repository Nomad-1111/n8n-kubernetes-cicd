# ----------------------------
# Service Account
# ----------------------------
serviceAccount:
  create: true
  name: n8n-prod-sa

# ----------------------------
# Image
# ----------------------------
imageRegistry: ""
image:
  repository: nomad1111/n8n-custom
  tag: main                   # <--- Prod builds from 'main' branch
  pullPolicy: IfNotPresent

# ----------------------------
# Ingress
# ----------------------------
ingress:
  enabled: true
  className: nginx
  host: n8n.yourdomain.com    # <--- adjust for real domain
  tls: []

# ----------------------------
# Service
# ----------------------------
service:
  type: ClusterIP
  port: 5678
  targetPort: 5678

# ----------------------------
# Persistent Storage
# ----------------------------
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 5Gi
  mountPath: /home/node/.n8n

# ----------------------------
# Pods
# ----------------------------
pods:
  frontend:
    enabled: false

  api:
    replicas: 2
    containers:
      api:
        image:
          repository: nomad1111/n8n-custom
          tag: main
        ports:
          - name: http
            containerPort: 5678
        env:
          - name: N8N_PORT
            value: "5678"
          - name: N8N_HOST
            value: "0.0.0.0"
          - name: GENERIC_TIMEZONE
            value: "Australia/Sydney"
          - name: N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS
            value: "true"
          - name: DB_TYPE
            value: "sqlite"
          - name: DB_SQLITE_VACUUM_ON_STARTUP
            value: "true"
          - name: N8N_BASIC_AUTH_ACTIVE
            value: "true"
          - name: N8N_BASIC_AUTH_USER
            value: "admin"
          - name: N8N_BASIC_AUTH_PASSWORD
            value: "admin123"
        volumeMounts:
          - name: n8n-data
            mountPath: /home/node/.n8n

# ----------------------------
# Volumes
# ----------------------------
volumes:
  - name: n8n-data
    persistentVolumeClaim:
      claimName: n8n-pvc

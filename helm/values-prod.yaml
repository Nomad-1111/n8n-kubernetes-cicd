# ============================================================================
# Helm Values - Production Environment
# ============================================================================
# This file contains configuration values for the production environment.
# These values override the default values in the Helm chart templates.
# This file is used when deploying to the 'main' branch via Argo CD.
# ============================================================================

# ----------------------------
# Service Account Configuration
# ----------------------------
serviceAccount:
  create: true
  name: n8n-prod-sa

# ----------------------------
# Application Settings
# ----------------------------
# Production uses multiple replicas for high availability
replicas: 2
timezone: Australia/Sydney

# Secure cookie configuration
# Set to true for production (HTTPS access required)
secureCookie: true

# ----------------------------
# Database Configuration
# ----------------------------
# Database type: sqlite or postgresdb
# SQLite: Simple, file-based (default, good for single-instance deployments)
# PostgreSQL: Recommended for production, multi-replica deployments, and high availability
# NOTE: Production with multiple replicas REQUIRES PostgreSQL (SQLite cannot be shared)
database:
  # Database type: sqlite or postgresdb
  # WARNING: If replicas > 1, you MUST use postgresdb (SQLite cannot be shared)
  type: sqlite  # Change to 'postgresdb' to use PostgreSQL
  
  # PostgreSQL configuration (only used when type: postgresdb)
  postgres:
    # PostgreSQL host (service name or external hostname)
    # Example: postgres-service.namespace.svc.cluster.local
    host: ""  # <--- UPDATE: PostgreSQL hostname or service name
    
    # PostgreSQL port (default: 5432)
    port: 5432
    
    # Database name
    database: ""  # <--- UPDATE: Database name
    
    # Database user
    user: ""  # <--- UPDATE: PostgreSQL username
    
    # Database password (use Kubernetes secret in production)
    # For production, use passwordSecret instead of plain text
    password: ""  # <--- UPDATE: PostgreSQL password (or use passwordSecret below)
    
    # Alternative: Use Kubernetes secret for password (recommended for production)
    # Uncomment and configure if using secrets instead of plain text password:
    # passwordSecret:
    #   name: postgres-secret  # Name of the Kubernetes secret
    #   key: password          # Key in the secret containing the password
    
    # SSL configuration (optional)
    ssl:
      # Enable SSL connection
      enable: false
      # Reject unauthorized certificates (recommended: true)
      rejectUnauthorized: true
  
  # SQLite configuration (only used when type: sqlite)
  sqlite:
    # Vacuum SQLite database on startup to optimize performance
    vacuumOnStartup: true

# ----------------------------
# Container Image Configuration
# ----------------------------
# Defines which Docker image to use and how to pull it.
# GitHub Actions CI/CD workflow automatically updates repository and tag
# when building and pushing images to Docker Hub.
image:
  # Custom image built by GitHub Actions CI/CD pipeline
  # Automatically updated by workflow when image is built and pushed
  # ⚠️ CONFIGURATION REQUIRED: Replace YOUR-DOCKERHUB-USERNAME/YOUR-REPO-NAME with your Docker Hub repository
  # See CONFIGURATION.md for details
  repository: YOUR-DOCKERHUB-USERNAME/YOUR-REPO-NAME
  # Image tag - matches branch name (develop, uat, main)
  # GitHub Actions builds and tags images based on branch
  tag: main
  # Image pull policy: Always, IfNotPresent, or Never
  # Always: Always pull latest (recommended for CI/CD to get latest builds)
  pullPolicy: Always
  
  # Optional: Image pull secrets for Docker Hub authentication
  # Recommended to avoid Docker Hub rate limits
  # pullSecrets: ["dockerhub-secret"]
  
  # Optional: Override container entrypoint if needed
  # command: ["/docker-entrypoint.sh"]
  # args: ["start"]

# ----------------------------
# Ingress Configuration
# ----------------------------
ingress:
  enabled: true
  className: nginx
  # PRODUCTION: Replace with your actual domain name
  # Example: n8n.yourcompany.com
  host: n8n.yourdomain.com    # <--- UPDATE THIS with your real domain
  # Production should use HTTPS for security
  protocol: https  # http or https (use https for production)
  # TLS configuration (for HTTPS)
  # Configured for automatic certificate management with cert-manager
  tls:
    enabled: true
    # Secret name where the certificate will be stored
    secretName: n8n-prod-tls
    # Certificate issuer configuration
    #
    # OPTION 1: Self-signed (current - works for local/development)
    # Use this for local development or when you don't have a real domain.
    # Note: Browsers will show security warnings (normal for self-signed certs).
    issuer:
      name: selfsigned-issuer
      kind: ClusterIssuer
    #
    # OPTION 2: Let's Encrypt (for production with real domain)
    # Use this when you have a real, publicly accessible domain.
    # Prerequisites:
    #   1. Real domain name (e.g., n8n.yourdomain.com)
    #   2. DNS A record pointing to your cluster's ingress controller IP
    #   3. Public accessibility (Let's Encrypt must reach your cluster on port 80)
    #   4. Run: .\scripts\setup-letsencrypt.ps1 -Email "your@email.com" -Environment "prod"
    #   5. Update ingress.host above to your real domain
    #
    # Then uncomment and use:
    # issuer:
    #   name: letsencrypt-prod  # or "letsencrypt-staging" for testing
    #   kind: ClusterIssuer
    #
    # See docs/LETSENCRYPT_SETUP.md for detailed instructions.

# ----------------------------
# Service Configuration
# ----------------------------
service:
  type: ClusterIP
  port: 5678
  targetPort: 5678

# ----------------------------
# Persistent Storage Configuration
# ----------------------------
# Persistent storage for n8n data (workflows, credentials, database).
# Data persists across pod restarts and deployments.
persistence:
  enabled: true
  # Storage class - must match existing PVC (storageClass is immutable)
  # Existing PVC was created with "standard", so we must keep it
  # WARNING: Changing this value requires deleting and recreating the PVC
  storageClass: "standard"
  accessMode: ReadWriteOnce
  # Production uses larger storage for more workflows and data
  size: 5Gi
  mountPath: /home/node/.n8n
